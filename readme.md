# UniBarrage æ–‡æ¡£ ğŸ“œâœ¨

**UniBarrage** æ˜¯ä¸€æ¬¾å¼€æºçš„é«˜æ€§èƒ½å®æ—¶ä»£ç†å·¥å…·ï¼Œä¸“ä¸ºå¼€å‘è€…è®¾è®¡ï¼Œæ—¨åœ¨ç»Ÿä¸€å¤šå¹³å°ï¼ˆå¦‚æŠ–éŸ³ã€å“”å“©å“”å“©ã€å¿«æ‰‹ã€æ–—é±¼ã€è™ç‰™ï¼‰ç›´æ’­å¼¹å¹•æ•°æ®çš„é‡‡é›†ã€è§£æå’Œè½¬å‘ã€‚é€šè¿‡æ ‡å‡†åŒ–çš„ WebSocket æ¶ˆæ¯åè®®å’Œçµæ´»çš„ API æ¥å£ï¼ŒUniBarrage å°†åˆ†æ•£çš„å¤šå¹³å°å¼¹å¹•æ•°æ®ç»Ÿä¸€ä¸ºä¸€è‡´çš„æ ¼å¼ï¼Œå¸®åŠ©å¼€å‘è€…æ›´é«˜æ•ˆåœ°æ„å»ºè·¨å¹³å°äº’åŠ¨åŠŸèƒ½ã€‚  

**UniBarrage** is an **open-source** high-performance real-time proxy tool designed for developers, focusing on unifying the collection, parsing, and forwarding of live barrage data from multiple platforms (e.g., Douyin, Bilibili, Kuaishou, Douyu, and Huya). With standardized WebSocket message protocols and flexible API interfaces, UniBarrage consolidates disparate multi-platform barrage data into a consistent format, enabling developers to build cross-platform interactive features more efficiently.

---

### **æ ¸å¿ƒç‰¹ç‚¹ ğŸŒŸ | Core Features**

- **å¤šå¹³å°æ”¯æŒ ğŸ–¥ï¸**ï¼šåŒæ—¶å…¼å®¹å¤šç§ä¸»æµç›´æ’­å¹³å°ï¼Œæ— éœ€é’ˆå¯¹ä¸åŒå¹³å°é‡å¤å¼€å‘ã€‚
-
  **Multi-Platform Support ğŸ–¥ï¸**: Compatible with various mainstream live streaming platforms, eliminating the need for repetitive development.
  
- **å®æ—¶æ€§å¼º âš¡**ï¼šé€šè¿‡é«˜æ€§èƒ½ WebSocket æä¾›æ¯«ç§’çº§å»¶è¿Ÿçš„å¼¹å¹•è½¬å‘æœåŠ¡ã€‚
-
  **High Real-Time Performance âš¡**: Leverages high-performance WebSocket to deliver millisecond-latency barrage forwarding services.
  
- **ç»Ÿä¸€æ•°æ®ç»“æ„ ğŸ”„**ï¼šç®€åŒ–å¼€å‘è€…å·¥ä½œï¼Œè½»æ¾å®ç°è·¨å¹³å°äº’åŠ¨åŠŸèƒ½ã€‚
-
  **Unified Data Structure ğŸ”„**: Simplifies development by enabling seamless cross-platform interactive features.
  
- **çµæ´»æ‰©å±•æ€§ ğŸ”§**ï¼šæ”¯æŒå¤šç§å¯åŠ¨å‚æ•°å’Œ API è°ƒç”¨ï¼Œæ»¡è¶³ä¸åŒåœºæ™¯çš„å®šåˆ¶åŒ–éœ€æ±‚ã€‚
-
  **Flexible Extensibility ğŸ”§**: Supports diverse startup parameters and API calls to meet the customization needs of various scenarios.
  
- **å°å·§çš„äºŒè¿›åˆ¶ä½“ç§¯ ğŸ“¦**ï¼šé«˜åº¦ä¼˜åŒ–çš„ä»£ç ï¼Œç¼–è¯‘åçš„äºŒè¿›åˆ¶æ–‡ä»¶å°äº 10MBï¼Œä¾¿äºåˆ†å‘å’Œéƒ¨ç½²ã€‚
-
  **Compact Binary Size ğŸ“¦**: Highly optimized code with a compiled binary size of less than 10MB, making it easy to distribute and deploy.
  
- **100% ä¸ä¸¢å¤±å¼¹å¹•æ¶ˆæ¯ ğŸ›¡ï¸**ï¼šå¾—ç›Šäº Go çš„é€šé“æœºåˆ¶å’Œé«˜æ€§èƒ½é˜Ÿåˆ—ï¼Œç¡®ä¿æ¯æ¡å¼¹å¹•éƒ½èƒ½è¢«å®‰å…¨ã€é«˜æ•ˆåœ°å¤„ç†å’Œè½¬å‘ã€‚
-
  **100% No Message Loss ğŸ›¡ï¸**: Powered by Go's channel mechanism and high-performance queues, ensuring every message is handled and forwarded safely and efficiently.
  
- **å¼€æºä¸ç¤¾åŒºæ”¯æŒ ğŸŒ**ï¼šå®Œå…¨å¼€æºï¼Œæ‹¥æœ‰æ´»è·ƒçš„ç¤¾åŒºæ”¯æŒï¼Œå¼€å‘è€…å¯è½»æ¾è´¡çŒ®æˆ–æ‰©å±•åŠŸèƒ½ã€‚
-
  **Open Source with Community Support ğŸŒ**: Fully open-source with an active community, allowing developers to easily contribute or extend its capabilities.

---

**UniBarrage** ä¸ä»…é€‚ç”¨äºä¸ªäººå¼€å‘è€…å¿«é€Ÿæ„å»ºé¡¹ç›®ï¼Œä¹Ÿä¸ºå›¢é˜Ÿåä½œæä¾›äº†ä¸€ä¸ªç¨³å®šã€å¯é çš„åŸºç¡€è®¾æ–½ï¼ŒåŠ©åŠ›ç›´æ’­ç”Ÿæ€çš„åˆ›æ–°å‘å±•ã€‚æ— è®ºæ˜¯å®ç°è·¨å¹³å°å¼¹å¹•å¢™ã€æ™ºèƒ½å¼¹å¹•åˆ†æï¼Œè¿˜æ˜¯ä¸è§‚ä¼—å®æ—¶äº’åŠ¨ï¼ŒUniBarrage éƒ½æ˜¯æ‚¨çš„å¾—åŠ›åŠ©æ‰‹ã€‚  
  
**UniBarrage** is not only ideal for individual developers to rapidly build projects but also provides a stable and reliable infrastructure for team collaboration, driving innovation in the live streaming ecosystem. Whether itâ€™s for building cross-platform barrage walls, performing intelligent barrage analysis, or engaging in real-time interaction with the audience, UniBarrage is your trusted assistant.

---

## ä¸€ã€æ–‡æ¡£å¤§çº²

1. [UniBarrage ç®€ä»‹ ğŸŒŸ](#unibarrage-intro)
2. [API æ¥å£æ–‡æ¡£ ğŸŒ](#api-documentation)
    - [å¯åŠ¨å‚æ•° âš™ï¸](#startup-parameters)
    - [API åˆ—è¡¨ ğŸ“¬](#api-list)
3. [WebSocket æ¶ˆæ¯ç»“æ„ ğŸ“¡](#websocket-message-structure)
    - [æ¶ˆæ¯å­—æ®µè¯´æ˜ ğŸ“œ](#message-field-descriptions)
    - [æ¶ˆæ¯ç±»å‹åŠç¤ºä¾‹ ğŸ§©](#message-types-and-examples)
4. [é”™è¯¯ç å‚è€ƒè¡¨ ğŸš¨](#error-codes)

---

<a id="unibarrage-intro"></a>

## UniBarrage ç®€ä»‹ ğŸŒŸ

UniBarrage æ˜¯ä¸€ä¸ªå¸®åŠ©å¼€å‘è€…ç»Ÿä¸€å¤„ç†å¤šå¹³å°ç›´æ’­å¼¹å¹•æ•°æ®çš„å·¥å…·ï¼Œæ”¯æŒé«˜æ€§èƒ½å®æ—¶ä»£ç†åŠæ ‡å‡†åŒ–è½¬å‘ã€‚

- **æ”¯æŒå¹³å°**: æŠ–éŸ³ã€å“”å“©å“”å“©ã€å¿«æ‰‹ã€æ–—é±¼ã€è™ç‰™
- **æ ¸å¿ƒåŠŸèƒ½**: ç»Ÿä¸€æ ¼å¼çš„ WebSocket æ¶ˆæ¯æµå’Œçµæ´»çš„ API æ¥å£

---

<a id="api-documentation"></a>

## API æ¥å£æ–‡æ¡£ ğŸŒ

<a id="startup-parameters"></a>

### å¯åŠ¨å‚æ•° âš™ï¸

| å‚æ•°å          | ç±»å‹       | é»˜è®¤å€¼         | æè¿°                      |
|--------------|----------|-------------|-------------------------|
| `-wsHost`    | `string` | `127.0.0.1` | WebSocket æœåŠ¡çš„ä¸»æœºåœ°å€       |
| `-wsPort`    | `int`    | `7777`      | WebSocket æœåŠ¡çš„ç«¯å£å·        |
| `-apiHost`   | `string` | `127.0.0.1` | API æœåŠ¡çš„ä¸»æœºåœ°å€             |
| `-apiPort`   | `int`    | `8080`      | API æœåŠ¡çš„ç«¯å£å·              |
| `-useProxy`  | `bool`   | `false`     | æ˜¯å¦å¯ç”¨ä»£ç†æœåŠ¡                |
| `-authToken` | `string` | `""`        | Bearer Token (ä»… API ä½¿ç”¨) |

#### ç¤ºä¾‹å‘½ä»¤ ğŸ› ï¸

```bash
# ç¤ºä¾‹ï¼šå¯åŠ¨ UniBarrage æœåŠ¡
./UniBarrage -wsHost 127.0.0.1 -wsPort 7777 -apiHost 127.0.0.1 -apiPort 8080 -useProxy
```

---

<a id="api-list"></a>

### API åˆ—è¡¨ ğŸ“¬

#### æ¬¢è¿æ¥å£ Welcome Endpoint ğŸ‘‹

- **URL**: `/`
- **æ–¹æ³• Method**: `GET`
- **æè¿° Description**: è¿”å›æ¬¢è¿ä¿¡æ¯ï¼ŒéªŒè¯æœåŠ¡æ˜¯å¦å¯åŠ¨ã€‚

**å“åº”ç¤ºä¾‹ Response Example:**

```json
{
  "code": 200,
  "message": "Hello, UniBarrage!",
  "data": null
}
```

#### è·å–æ‰€æœ‰æœåŠ¡çŠ¶æ€ Get All Services Status ğŸ”„

- **URL**: `/all`
- **æ–¹æ³• Method**: `GET`
- **æè¿° Description**: è·å–æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„æœåŠ¡çŠ¶æ€ã€‚

**å“åº”ç¤ºä¾‹ Response Example:**

```json
{
  "code": 200,
  "message": "è·å–æˆåŠŸ Retrieved successfully",
  "data": [
    {
      "platform": "douyin",
      "rid": "123456"
    },
    {
      "platform": "bilibili",
      "rid": "789012"
    }
  ]
}
```

#### è·å–æŒ‡å®šå¹³å°çš„æ‰€æœ‰æœåŠ¡ Get Services for Specific Platform ğŸ”

- **URL**: `/{platform}`
- **æ–¹æ³• Method**: `GET`
- **æè¿° Description**: è·å–æŒ‡å®šå¹³å°çš„æ‰€æœ‰æœåŠ¡ã€‚

**è¯·æ±‚å‚æ•° Request Parameters:**

- `platform`ï¼ˆè·¯å¾„å‚æ•° Path Parameterï¼‰ï¼šéœ€è¦æŸ¥è¯¢çš„ç›´æ’­å¹³å°åç§°ï¼Œä¾‹å¦‚ `douyin`, `bilibili`, `kuaishou`, `douyu`, `huya`.

**å“åº”ç¤ºä¾‹ Response Example:**

```json
{
  "code": 200,
  "message": "è·å–æˆåŠŸ Retrieved successfully",
  "data": [
    {
      "platform": "douyin",
      "rid": "123456"
    }
  ]
}
```

#### è·å–å•ä¸ªæœåŠ¡çŠ¶æ€ Get Single Service Status ğŸ§

- **URL**: `/{platform}/{roomId}`
- **æ–¹æ³• Method**: `GET`
- **æè¿° Description**: è·å–æŒ‡å®šæˆ¿é—´çš„æœåŠ¡çŠ¶æ€ã€‚

**è¯·æ±‚å‚æ•° Request Parameters:**

- `platform`ï¼ˆè·¯å¾„å‚æ•° Path Parameterï¼‰ï¼šç›´æ’­å¹³å°åç§° Platform name.
- `roomId`ï¼ˆè·¯å¾„å‚æ•° Path Parameterï¼‰ï¼šæˆ¿é—´ ID Room ID.

**å“åº”ç¤ºä¾‹ Response Example:**

```json
{
  "code": 200,
  "message": "è·å–æˆåŠŸ Retrieved successfully",
  "data": {
    "platform": "douyin",
    "rid": "123456"
  }
}
```

#### å¯åŠ¨æœåŠ¡ Start Service ğŸš€

- **URL**: `/{platform}`
- **æ–¹æ³• Method**: `POST`
- **æè¿° Description**: å¯åŠ¨æŒ‡å®šå¹³å°çš„ç›´æ’­æœåŠ¡ã€‚

**è¯·æ±‚ä½“ Request Body Example:**

```json
{
  "rid": "123456",
  "cookie": "å¯é€‰çš„ç™»å½•cookie Optional login cookie"
}
```

**è¯·æ±‚å‚æ•° Request Parameters:**

- `platform`ï¼ˆè·¯å¾„å‚æ•° Path Parameterï¼‰ï¼šç›´æ’­å¹³å°åç§° Platform name.
- `rid`ï¼ˆè¯·æ±‚ä½“å‚æ•° Body Parameterï¼‰ï¼šæˆ¿é—´ ID Room ID.
- `cookie`ï¼ˆè¯·æ±‚ä½“å‚æ•° Body Parameter, å¯é€‰ Optionalï¼‰ï¼šç”¨äºéœ€è¦ç™»å½•çš„æœåŠ¡ Used for services requiring login.

**å“åº”ç¤ºä¾‹ Response Example:**

```json
{
  "code": 201,
  "message": "æœåŠ¡å¯åŠ¨æˆåŠŸ Service started successfully",
  "data": {
    "platform": "douyin",
    "rid": "123456"
  }
}
```

#### åœæ­¢æœåŠ¡ Stop Service ğŸ›‘

- **URL**: `/{platform}/{roomId}`
- **æ–¹æ³• Method**: `DELETE`
- **æè¿° Description**: åœæ­¢æŒ‡å®šå¹³å°æˆ¿é—´çš„æœåŠ¡ã€‚

**è¯·æ±‚å‚æ•° Request Parameters:**

- `platform`ï¼ˆè·¯å¾„å‚æ•° Path Parameterï¼‰ï¼šç›´æ’­å¹³å°åç§° Platform name.
- `roomId`ï¼ˆè·¯å¾„å‚æ•° Path Parameterï¼‰ï¼šæˆ¿é—´ ID Room ID.

**å“åº”ç¤ºä¾‹ Response Example:**

```json
{
  "code": 200,
  "message": "æœåŠ¡å·²åœæ­¢ Service stopped",
  "data": {
    "platform": "douyin",
    "rid": "123456"
  }
}
```

---

<a id="websocket-message-structure"></a>

## WebSocket æ¶ˆæ¯ç»“æ„ ğŸ“¡

<a id="message-field-descriptions"></a>

### æ¶ˆæ¯å­—æ®µè¯´æ˜ ğŸ“œ

```text
- rid: æˆ¿é—´å· Room ID
- platform: æ¥æºå¹³å° Platform (å¦‚ Douyin, Bilibili)
- type: æ¶ˆæ¯ç±»å‹ Message Type
  - Chat: èŠå¤©æ¶ˆæ¯
  - Gift: ç¤¼ç‰©æ¶ˆæ¯
  - Like: ç‚¹èµæ¶ˆæ¯
  - EnterRoom: è¿›å…¥æˆ¿é—´æ¶ˆæ¯
  - Subscribe: è®¢é˜…æ¶ˆæ¯
  - SuperChat: è¶…çº§èŠå¤©æ¶ˆæ¯
  - EndLive: ç»“æŸç›´æ’­æ¶ˆæ¯
```

<a id="message-types-and-examples"></a>

### æ¶ˆæ¯ç±»å‹åŠç¤ºä¾‹ ğŸ§©

#### Chat æ¶ˆæ¯ Chat Message ğŸ’¬

```json
{
  "name": "å‘é€è€…åç§° Sender",
  "avatar": "å‘é€è€…å¤´åƒ URL Avatar URL",
  "content": "èŠå¤©å†…å®¹ Content",
  "emoticon": [
    "è¡¨æƒ…URL Emoticon URLs"
  ],
  "raw": "åŸå§‹æ•°æ® Raw Data"
}
```

#### Gift æ¶ˆæ¯ Gift Message ğŸ

```json
{
  "name": "èµ é€è€…åç§° Sender",
  "avatar": "èµ é€è€…å¤´åƒ URL Avatar URL",
  "item": "ç¤¼ç‰©åç§° Gift Name",
  "num": "ç¤¼ç‰©æ•°é‡ Gift Quantity",
  "price": "ç¤¼ç‰©å•ä»· Gift Price",
  "giftIcon": "ç¤¼ç‰©å›¾æ ‡ URL Gift Icon URL",
  "raw": "åŸå§‹æ•°æ® Raw Data"
}
```

#### Like æ¶ˆæ¯ Like Message ğŸ‘

```json
{
  "name": "ç‚¹èµè€…åç§° Liker",
  "avatar": "ç‚¹èµè€…å¤´åƒ URL Avatar URL",
  "count": "ç‚¹èµæ¬¡æ•° Like Count",
  "raw": "åŸå§‹æ•°æ® Raw Data"
}
```

#### EnterRoom æ¶ˆæ¯ Enter Room Message ğŸ 

```json
{
  "name": "è¿›å…¥è€…åç§° Participant",
  "avatar": "è¿›å…¥è€…å¤´åƒ URL Avatar URL",
  "raw": "åŸå§‹æ•°æ® Raw Data"
}
```

#### Subscribe æ¶ˆæ¯ Subscribe Message ğŸ›ï¸

```json
{
  "name": "è®¢é˜…è€…åç§° Subscriber",
  "avatar": "è®¢é˜…è€…å¤´åƒ URL Avatar URL",
  "item": "è®¢é˜…é¡¹ Subscription Item",
  "num": "è®¢é˜…æ¬¡æ•° Subscription Count",
  "price": "è®¢é˜…å•ä»· Subscription Price",
  "raw": "åŸå§‹æ•°æ® Raw Data"
}
```

#### SuperChat æ¶ˆæ¯ Super Chat Message ğŸ’µ

```json
{
  "name": "å‘é€è€…åç§° Sender",
  "avatar": "å‘é€è€…å¤´åƒ URL Avatar URL",
  "content": "è¶…çº§èŠå¤©å†…å®¹ Content",
  "price": "é‡‘é¢ Price",
  "raw": "åŸå§‹æ•°æ® Raw Data"
}
```

#### EndLive æ¶ˆæ¯ End Live Message ğŸ“´

```json
{
  "raw": "åŸå§‹æ•°æ® Raw Data"
}
```

---

<a id="error-codes"></a>

## é”™è¯¯ç å‚è€ƒè¡¨ ğŸš¨

| é”™è¯¯ç  Code | æè¿° Description            |
|----------|---------------------------|
| `200`    | âœ… è¯·æ±‚æˆåŠŸ Request successful |
| `201`    | âœ… æœåŠ¡åˆ›å»ºæˆåŠŸ Service created  |
| `400`    | âš ï¸ è¯·æ±‚å‚æ•°é”™è¯¯ Bad request     |
| `404`    | âŒ æœåŠ¡æœªæ‰¾åˆ° Service not found |
| `500`    | âŒ æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ Internal error  |

---

ğŸ’¡ **æç¤º Tips:** æ­¤æ–‡æ¡£æ•´åˆäº† API å’Œ WebSocket æ¶ˆæ¯ç»“æ„çš„æ‰€æœ‰ä¿¡æ¯ï¼Œæä¾›å¼€å‘è€…ä¸€ä¸ªæ¸…æ™°ã€ä¸€è‡´çš„å‚è€ƒæ¡†æ¶ï¼

